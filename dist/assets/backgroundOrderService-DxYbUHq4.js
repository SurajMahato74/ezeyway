const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C2HGdyT6.js","assets/index.css"])))=>i.map(i=>d[i]);
var l=Object.defineProperty;var _=(i,r,e)=>r in i?l(i,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[r]=e;var u=(i,r,e)=>_(i,typeof r!="symbol"?r+"":r,e);import{C as h,_ as c}from"./index-C2HGdyT6.js";class g{constructor(){u(this,"isRunning",!1);u(this,"intervalId",null);u(this,"lastCheckedOrders",new Set)}async start(){if(!(this.isRunning||!h.isNativePlatform())&&(console.log("ðŸ”„ Starting background order service"),this.isRunning=!0,this.intervalId=setInterval(()=>{this.checkForNewOrders()},1e4),h.isNativePlatform())){const{App:r}=await c(async()=>{const{App:e}=await import("./index-C2HGdyT6.js").then(o=>o.i);return{App:e}},__vite__mapDeps([0,1]));r.addListener("appStateChange",({isActive:e})=>{e&&this.checkForNewOrders()})}}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.isRunning=!1,console.log("â¹ï¸ Background order service stopped")}async checkForNewOrders(){try{const{authService:r}=await c(async()=>{const{authService:n}=await import("./index-C2HGdyT6.js").then(t=>t.b);return{authService:n}},__vite__mapDeps([0,1])),{apiRequest:e}=await c(async()=>{const{apiRequest:n}=await import("./index-C2HGdyT6.js").then(t=>t.c);return{apiRequest:n}},__vite__mapDeps([0,1]));if(!await r.autoLogin())return;const{response:a,data:d}=await e("orders/vendor/pending/");if(a.ok&&d){const n=Array.isArray(d)?d:d.results||[],t=n.filter(s=>!this.lastCheckedOrders.has(s.id));if(t.length>0){console.log("ðŸ†• Found new orders:",t.length),n.forEach(s=>this.lastCheckedOrders.add(s.id));for(const s of t)await this.triggerPushNotification(s)}}}catch(r){console.error("Error checking for new orders:",r)}}async triggerPushNotification(r){try{const{simpleNotificationService:e}=await c(async()=>{const{simpleNotificationService:o}=await import("./index-C2HGdyT6.js").then(a=>a.s);return{simpleNotificationService:o}},__vite__mapDeps([0,1]));console.log("ðŸš€ Triggering notification for order:",r.order_number),await e.showOrderNotification(r.order_number,r.total_amount,r.id)}catch(e){console.error("Error triggering push notification:",e)}}async sendPushNotificationViaServer(r){try{const{apiRequest:e}=await c(async()=>{const{apiRequest:o}=await import("./index-C2HGdyT6.js").then(a=>a.c);return{apiRequest:o}},__vite__mapDeps([0,1]));await e("/api/send-push-notification/",{method:"POST",body:JSON.stringify({type:"order",orderId:r.id,orderNumber:r.order_number,amount:r.total_amount,vendorId:r.vendor_id})}),console.log("ðŸ“¤ Push notification sent via server")}catch(e){console.error("Failed to send push notification via server:",e)}}clearTrackedOrders(){this.lastCheckedOrders.clear()}}const p=new g;export{p as backgroundOrderService};
