var n=Object.defineProperty;var l=(i,e,r)=>e in i?n(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r;var t=(i,e,r)=>l(i,typeof e!="symbol"?e+"":e,r);import{A as o}from"./index-JjaIH_pX.js";class d{constructor(){t(this,"vendorCache",new Map);t(this,"fetchingVendors",!1);t(this,"lastFetchTime",0);t(this,"CACHE_TTL",5*60*1e3);t(this,"deliveryRadiusCache",null);t(this,"deliveryRadiusLastFetch",0);t(this,"DELIVERY_RADIUS_CACHE_TTL",10*60*1e3)}async getVendorProfile(e){const r=this.vendorCache.get(e);if(r&&Date.now()-this.lastFetchTime<this.CACHE_TTL)return r;try{const s=await fetch(`${o}vendor-profiles/${e}/`,{headers:{"ngrok-skip-browser-warning":"true"}});if(!s.ok)return console.error(`Failed to fetch vendor profile for ID ${e}`),null;const a=await s.json();return this.vendorCache.set(e,a),a}catch(s){return console.error("Error fetching vendor profile:",s),null}}async refreshVendorProfiles(){if(!this.fetchingVendors){this.fetchingVendors=!0;try{const e=await fetch(`${o}vendor-profiles/`,{headers:{"ngrok-skip-browser-warning":"true"}});if(!e.ok)throw new Error("Failed to fetch vendor profiles");((await e.json()).results||[]).forEach(a=>{this.vendorCache.set(a.id,a)}),this.lastFetchTime=Date.now()}catch(e){console.error("Error refreshing vendor profiles:",e)}finally{this.fetchingVendors=!1}}}getDeliveryRadius(e){const r=this.vendorCache.get(e);return(r==null?void 0:r.delivery_radius)??null}async getGlobalDeliveryRadius(){if(this.deliveryRadiusCache&&Date.now()-this.deliveryRadiusLastFetch<this.DELIVERY_RADIUS_CACHE_TTL)return this.deliveryRadiusCache.is_active?this.deliveryRadiusCache.radius:null;try{const e=await fetch(`${o}delivery-radius/`,{headers:{"ngrok-skip-browser-warning":"true"}});if(!e.ok)return console.warn("Failed to fetch global delivery radius, using fallback"),null;const r=await e.json();return console.log("Delivery radius API response:",r),r&&typeof r.delivery_radius=="number"?(this.deliveryRadiusCache={id:1,radius:r.delivery_radius,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},this.deliveryRadiusLastFetch=Date.now(),r.delivery_radius):null}catch(e){return console.error("Error fetching global delivery radius:",e),null}}}const u=new d;export{u as vendorService};
